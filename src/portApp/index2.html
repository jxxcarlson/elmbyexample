<!DOCTYPE HTML>
<html>
<head>
  <meta charset="UTF-8">
  <title>App eff9</title>
  <link rel="stylesheet" href="whatever-you-want.css">
  <script src="main.js"></script>
</head>

<body>
  <div id="elm"></div>
  <script>
  var app = Elm.Main.init({
    node: document.getElementById('elm')
  , flags : {"thisAppId": "fff9", "otherAppId":  "a0b3"}
  });

  var app_id = 'fff9'

  var other_app_id = 'a0b3'

  app.ports.sendMessage.subscribe(function(data) {
     console.log("DATA: " + JSON.stringify(data))
    localStorage.setItem(app_id, JSON.stringify(data));
  });

  app.ports.getAndDeleteMessage.subscribe(function(data) {
    var message_ = localStorage.getItem(other_app_id)
    localStorage.setItem(other_app_id, "none")
    app.ports.receiveMessage.send(JSON.parse(message_))
  });

  app.ports.getMessage.subscribe(function(data) {
    var message_ = localStorage.getItem(other_app_id)
    app.ports.receiveMessage.send(message_)
  });

  // var message = localStorage.getItem(other_app_id)

  console.log("Message for " + app_id + ": "+ message)

  app.ports.receiveMessage.send(message);
  </script>
</body>
</html>
